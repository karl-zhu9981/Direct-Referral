<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <script src="signOut.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap" rel="stylesheet" />
    <link rel="icon" href="images/icon.ico" />
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="/__/firebase/7.17.1/firebase-app.js"></script>
    <!-- Add the entire Firebase JavaScript SDK -->
    <script src="/__/firebase/7.17.1/firebase.js"></script>
    <!-- Initialize Firebase -->
    <script src="/__/firebase/init.js"></script>

    <script type="text/javascript">// Initialize Firebase with a "default" Firebase project
        var defaultProject = firebase.initializeApp(firebaseConfig);
        console.log(defaultProject.name);  // "[DEFAULT]"
        // Option 1: Access Firebase services via the defaultProject variable
        var defaultStorage = defaultProject.storage();
        var defaultFirestore = defaultProject.firestore();
    </script>

    <title>Direct Referral</title>
</head>

<body style="background-color: #21145F;">
    <nav>
        <div class="logo">
            <img src="images/dom-logo.png" width="300" />
        </div>
        <div class="header">
            <h1 style="color: aliceblue;" id="userName">Welcome, </h1>
            <script> 
                var user = firebase.auth().currentUser;
                console.log(user);
                var name;
    
                if (user != null) {
                    name = user.displayName;
                    console.log(name);
                }
                document.getElementById("userName").innerHTML = name;
            </script>
        </div>
        <ul class="nav-links">
            <li><button class="button-links" onclick="signOut()" >Sign Out</button></li>
        </ul>
        <div class="menu">
            <div class="1"></div>
            <div class="2"></div>
            <div class="3"></div>
            <div class="4"></div>
        </div>
    </nav>

    <div class="header">
        <h1 style="color: aliceblue;">Direct Referral</h1>
    </div>

    <section class="index">
        <script src="application.js"></script>
        <script src="app.js"></script>

        <div class="tab">
            <button class="tablinks" onclick="openDiag(event, 'DVT')" id="defaultOpen">Deep Vein Thrombosis</button>
            <button class="tablinks" onclick="openDiag(event, 'COVID-19')">COVID-19</button>
            
        </div>
        
        <!-- Tab content -->
        <div id="DVT" class="tabcontent">
            <h3>Deep Vein Thrombosis</h3>
            <br>
            <section class="row"> 
                <section class ="column"> 
                    <h3>Patient Information</h3>
                    <p for="name"> Patient name:</p>
                    <input type="text" id="name" name="Name"><br>
                    <p for="hID"> Health Card:</p>
                    <input type="number" id="hID" name="Health Card"><br>
                    <p for="DOB"> Date of Birth:</p>
                    <input type="date" id="DOB" name="DOB"><br>
                    <p for="phone"> Phone Number:</p>
                    <input type="number" id="phone" name="Phone Number"><br>
                    <p for="altC"> Alternate Contact:</p>
                    <input type="text" id="altC" name="Alternate Contact"><br>
                    <p for="altP"> Alternate Phone:</p>
                    <input type="number" id="altP" name="Alternate Phone"><br><br>
        
                    <p>Please select suspected DVT leg:</p>
                    <input type="radio" id="left" name="leg" value="left">
                    <label for="left">Left</label><br>
                    <input type="radio" id="right" name="leg" value="right">
                    <label for="right">Right</label><br>
                    <input type="radio" id="both" name="leg" value="both">
                    <label for="both">Both</label>
                    <br> <br>
                </section>

                <section class="column">
                    <h3>Referring MD:</h3>
                    <p for="nameMD"> Name:</p>
                    <input type="text" id="nameMD" name="MD Name"><br>
                    <p for="phoneMD"> Phone:</p>
                    <input type="number" id="phoneMD" name="MD Phone Number"><br>
                    <p for="billingMD"> Billing Number:</p>
                    <input type="number" id="billingMD" name="MD Billing"><br>
                    <p for="referDate"> Date of Referral:</p>
                    <input type="date" id="referDate" name="Referral Date"><br>
                </section>

            </section>

            <section class="row">
                <section class="column">
                    <h3> Anticoagulant Used</h3>
                    <p for="aName"> Name:</p>
                    <input type="text" id="aName" name="Name"><br>
                    <p for="dAmount"> Dose amount in miligrams:</p>
                    <input type="number" id="dAmount" name="Dose Amount"><br>
                    <p for="timeAdmin"> Time Administered:</p>
                    <input type="time" id="timeAdmin" name="Time Admin"><br>
                    <p for="dateAdmin"> Date Administered:</p>
                    <input type="date" id="dateAdmin" name="Date Admin"><br><br>
                </section>

                <section class="column">
                    <h3> Next Dose Scheduled At</h3>
                    <p for="timeNext"> Time:</p>
                    <input type="time" id="timeNext" name="Time Next"><br>
                    <p for="dateNext"> Date:</p>
                    <input type="date" id="dateNext" name="Date Next"><br><br><br><br>
                </section>
            </section>
            <br>
            <br>

            <h3> Wells Deep Vein Thrombosis Model</h3><br>
                <section>
                    <p>Previous DVT</p>
                    <div class="toggleswitch" >
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq1" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq1">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
            
              <br>
  
              <section>
                <p>Paralysis, paresis or recent plaster immobilization of the legs</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq2" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq2">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
  
              
              <br>
  
              <section>
                <p>Bedridden > 3 days or major surgery within 4 weeks</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq3" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq3">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
  
              <br>
  
              <section>
                <p>Active cancer (treatment ongoing or within 6 months or palliative)</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq4" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq4">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
              
              <br>
  
              <section>
                <p>Tenderness along the distribution of the deep veins</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq5" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq5">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
  
              <br>
  
              <section>
                <p>Calf swelling 3 cm more than asymptomatic leg (measured 10 cm below the tibial tuberosity)</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq6" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq6">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
           
              <br>
  
              <section>
                <p>Pitting edema greater in the symptomatic leg</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq7" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq7">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
  
              <br>
  
              <section>
                <p>Collateral superficial non varicose veins</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq8" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq8">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
  
              <br>
              
              <section>
                <p>Entire leg swollen</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="DVTq9" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq9">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
  
              <br>
  
              <section>
                <p>Alternative diagnosis at least as likely as DVT (e.g. cellulitis, Bakerâ€™s cyst, MSK injury)</p>
                <div class="toggleswitch">
                    <input type="checkbox" onclick="adjust_score(this,-2)" class="toggleswitch-checkbox" id="DVTq10" tabindex="0">
                    <label class="toggleswitch-label" for="DVTq10">
                        <span class="toggleswitch-inner2"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>
  
              <br>
  
              <section>
                <h3 id="total">Score: 0</h3>
                <h3 id="prob_text">DVT Unlikely</h3>
              </section>
            
              <script>
                let score = 0 
                function adjust_score(toggle_box, number) {
                    if ($(toggle_box).is(":checked")){
                        let new_score = score + number
                        //let score_sctring = 
                        document.getElementById("total").innerHTML = "Score: ".concat(new_score)
                        score = new_score
        
                        if (score >= 2) {
                            document.getElementById("prob_text").innerHTML = "DVT Likely"
                        } else {
                            document.getElementById("prob_text").innerHTML = "DVT Unlikely"
                        }
        
                    } else {
                        let new_score = score - number
                        //let score_sctring = 
                        document.getElementById("total").innerHTML = "Score: ".concat(new_score)
                        score = new_score
        
                        if (score >= 2) {
                            document.getElementById("prob_text").innerHTML = "DVT Likely"
                        } else {
                            document.getElementById("prob_text").innerHTML = "DVT Unlikely"
                        }
        
                    }
  
                }
  
              </script>
              <br>

            <section>
            <button class="button-links" onclick="sendEmail()" >Direct Refer Now!</button>
            </section>    

            <script>
                function sendEmail() {

                    let MDname = document.getElementById("nameMD").value
                    let MDphone = document.getElementById("phoneMD").value
                    let billingNumber = document.getElementById("billingMD").value

                    
                    let patientName = document.getElementById("name").value
                    let patinetID = document.getElementById("hID").value
                    let patientBD = document.getElementById("DOB").value
                    let patientPhone = document.getElementById("phone").value
                    let patientContactAlt = document.getElementById("altC").value
                    let patientPhoneAlt = document.getElementById("altP").value
                    
                    //Check the radio button for the afflicted leg
                    let leg = null
                    for (let name of ["right","left", "both"]){
                        if (document.getElementById(name).checked){
                            leg = name
                        }
                    }

                    let anticoagName = document.getElementById("aName").value
                    let anticoagDose = document.getElementById("dAmount").value
                    let anticoagTime = document.getElementById("timeAdmin").value
                    let anticoagDate = document.getElementById("dateAdmin").value
                    let anticoagTimeNext = document.getElementById("timeNext").value
                    let anticoagDateNext = document.getElementById("dateNext").value
                    let totalScore = document.getElementById("total").innerHTML.slice(7)

                    let emailSubject = "New Referral! " + Date()

                    let mailBody = "Physician Name: " + MDname + "\n<br />" +
                               "Physician Phone: " + MDphone +"\n<br />" +
                               "Physicuan Billing: " + billingNumber +"\n<br />" +
                               "=========================================" +"\n<br />" +
                               "Patient Name: " + patientName +"\n<br />" +
                               "Patient ID: " + patinetID + "\n<br />" + 
                               "Patient DOB: " + patientBD + "\n<br />" +
                               "Patient Phone: " + patientPhone + "\n<br />" +
                               "Patient Alternative Contact: " + patientContactAlt + "\n<br />" +
                               "Patient Alternative Phone: " + patientPhoneAlt + "\n<br />" +
                               "=========================================" +"\n<br />" +
                               "Suspected Leg: " + leg + "\n<br />" +
                               "Anticoagulation Name: " + anticoagName + "\n<br />" +
                               "Anticoagulation Dose: " + anticoagDose + "\n<br />" +
                               "Anticoagulation Time Administered: " + anticoagTime + "\n<br />" +
                               "Anticoagulation Date Administered: " + anticoagDate + "\n<br />" +
                               "Anticoagulation Time Next Dose: " + anticoagTimeNext + "\n<br />" +
                               "Anticoagulation Date Next Dose: " + anticoagDateNext + "\n<br />" +
                               "=========================================" +"\n<br />" +
                               "Wells Score: " + totalScore +"\n<br />"


                    Email.send({
                        Host : "",
                        Username : "",
                        Password : "",
                        To : 'sshah128@uottawa.ca',
                        From: 'NoReply@DirectReferral.ca',
                        Subject : emailSubject,
                        Body: mailBody
                    }).then(
                    message => alert("Referral was sent succesfully")
                    );
                    }


            </script>
              
            
        </div>
        
        <div id="COVID-19" class="tabcontent">
            <h3>COVID-19</h3><br>
            <h3>Patient Information</h3>
            <p for="name"> Patient name:</p>
            <input type="text" id="name" name="Name"><br>
            <p for="hID"> Health Card:</p>
            <input type="number" id="hID" name="Health Card"><br>
            <p for="DOB"> Date of Birth:</p>
            <input type="date" id="DOB" name="DOB"><br><br>

            <section>
                <p>Test Question</p>
                <div class="toggleswitch" >
                    <input type="checkbox" onclick="adjust_score(this,1)" class="toggleswitch-checkbox" id="CO-19q1" tabindex="0">
                    <label class="toggleswitch-label" for="CO-19q1">
                        <span class="toggleswitch-inner"></span>
                        <span class="toggleswitch-switch"></span>
                    </label>
                </section>

        </div>

        <script>
            // Get the element with id="defaultOpen" and click on it
            document.getElementById("defaultOpen").click();
        </script>
    </section>
    
</body>

</html>
